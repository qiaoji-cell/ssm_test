<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.axjy.mapper.dayRegister.CourseCountMapper">

<!--课程考勤统计-->
  <select id="findAll" resultType="com.axjy.pojo.dayRegister.OurseAttendanceRecord">
    select record.*,student.student_code,student.studentName,student.gender,class.className,parents.relation_name,parents.phone,classmodel.gName from kms_ourse_attendance_record as record
                                                                                                                                                        INNER JOIN kms_student as student on record.student_id = student.id
                                                                                                                                                        INNER JOIN kms_class as class on class.id = student.id
                                                                                                                                                        INNER JOIN kms_parents as parents on parents.student_id = student.id
                                                                                                                                                        INNER JOIN kms_classmodel as classmodel on classmodel.id = student.id
                                        <where>
                                          <if test="ourseAttendanceRecord.className!=null and ourseAttendanceRecord.className!='' ">
                                            and class.className = #{ourseAttendanceRecord.className}
                                          </if>
                                          <if test="ourseAttendanceRecord.willIntoDateStart!=null and ourseAttendanceRecord.willIntoDateStart!=''">
                                            and  record.attendance_date >= #{ourseAttendanceRecord.willIntoDateStart}
                                          </if>
                                          <if test="ourseAttendanceRecord.willIntoDateEnd!=null and ourseAttendanceRecord.willIntoDateEnd!=''">
                                            and record.attendance_date  &lt;= #{ourseAttendanceRecord.willIntoDateEnd}
                                          </if>
                                          <if test="ourseAttendanceRecord.gName!=null and ourseAttendanceRecord.gName!='' ">
                                            and classmodel.gName = #{ourseAttendanceRecord.gName}
                                          </if>
                                        </where>
  </select>



  <select id="keshiozongji" resultType="java.lang.Integer">
    select sum(use_courseTime) from kms_ourse_attendance_record
  </select>










  <resultMap id="BaseResultMap" type="com.axjy.pojo.dayRegister.OurseAttendanceRecord">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="student_id" jdbcType="BIGINT" property="studentId" />
    <result column="course_id" jdbcType="BIGINT" property="courseId" />
    <result column="attendance_state" jdbcType="INTEGER" property="attendanceState" />
    <result column="attendance_date" jdbcType="TIMESTAMP" property="attendanceDate" />
    <result column="use_courseTime" jdbcType="INTEGER" property="useCoursetime" />
    <result column="created_by" jdbcType="BIGINT" property="createdBy" />
    <result column="attendance_type" jdbcType="INTEGER" property="attendanceType" />
    <result column="remark" jdbcType="BIGINT" property="remark" />
  </resultMap>
  <sql id="Base_Column_List">
    id, student_id, course_id, attendance_state, attendance_date, use_courseTime, created_by, 
    attendance_type, remark
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from kms_ourse_attendance_record
    where id = #{id,jdbcType=BIGINT}
  </select>


  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from kms_ourse_attendance_record
    where id = #{id,jdbcType=BIGINT}
  </delete>

  <insert id="insert" keyColumn="id" keyProperty="id" parameterType="com.axjy.pojo.dayRegister.OurseAttendanceRecord" useGeneratedKeys="true">
    insert into kms_ourse_attendance_record (student_id, course_id, attendance_state, 
      attendance_date, use_courseTime, created_by, 
      attendance_type, remark)
    values (#{studentId,jdbcType=BIGINT}, #{courseId,jdbcType=BIGINT}, #{attendanceState,jdbcType=INTEGER}, 
      #{attendanceDate,jdbcType=TIMESTAMP}, #{useCoursetime,jdbcType=INTEGER}, #{createdBy,jdbcType=BIGINT}, 
      #{attendanceType,jdbcType=INTEGER}, #{remark,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" keyColumn="id" keyProperty="id" parameterType="com.axjy.pojo.dayRegister.OurseAttendanceRecord" useGeneratedKeys="true">
    insert into kms_ourse_attendance_record
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="studentId != null">
        student_id,
      </if>
      <if test="courseId != null">
        course_id,
      </if>
      <if test="attendanceState != null">
        attendance_state,
      </if>
      <if test="attendanceDate != null">
        attendance_date,
      </if>
      <if test="useCoursetime != null">
        use_courseTime,
      </if>
      <if test="createdBy != null">
        created_by,
      </if>
      <if test="attendanceType != null">
        attendance_type,
      </if>
      <if test="remark != null">
        remark,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="studentId != null">
        #{studentId,jdbcType=BIGINT},
      </if>
      <if test="courseId != null">
        #{courseId,jdbcType=BIGINT},
      </if>
      <if test="attendanceState != null">
        #{attendanceState,jdbcType=INTEGER},
      </if>
      <if test="attendanceDate != null">
        #{attendanceDate,jdbcType=TIMESTAMP},
      </if>
      <if test="useCoursetime != null">
        #{useCoursetime,jdbcType=INTEGER},
      </if>
      <if test="createdBy != null">
        #{createdBy,jdbcType=BIGINT},
      </if>
      <if test="attendanceType != null">
        #{attendanceType,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.axjy.pojo.dayRegister.OurseAttendanceRecord">
    update kms_ourse_attendance_record
    <set>
      <if test="studentId != null">
        student_id = #{studentId,jdbcType=BIGINT},
      </if>
      <if test="courseId != null">
        course_id = #{courseId,jdbcType=BIGINT},
      </if>
      <if test="attendanceState != null">
        attendance_state = #{attendanceState,jdbcType=INTEGER},
      </if>
      <if test="attendanceDate != null">
        attendance_date = #{attendanceDate,jdbcType=TIMESTAMP},
      </if>
      <if test="useCoursetime != null">
        use_courseTime = #{useCoursetime,jdbcType=INTEGER},
      </if>
      <if test="createdBy != null">
        created_by = #{createdBy,jdbcType=BIGINT},
      </if>
      <if test="attendanceType != null">
        attendance_type = #{attendanceType,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.axjy.pojo.dayRegister.OurseAttendanceRecord">
    update kms_ourse_attendance_record
    set student_id = #{studentId,jdbcType=BIGINT},
      course_id = #{courseId,jdbcType=BIGINT},
      attendance_state = #{attendanceState,jdbcType=INTEGER},
      attendance_date = #{attendanceDate,jdbcType=TIMESTAMP},
      use_courseTime = #{useCoursetime,jdbcType=INTEGER},
      created_by = #{createdBy,jdbcType=BIGINT},
      attendance_type = #{attendanceType,jdbcType=INTEGER},
      remark = #{remark,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>


</mapper>